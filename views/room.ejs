<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Room - <%= roomName %></title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/styleroom.css">
  <script src="/socket.io/socket.io.js"></script>
</head>
<style>
  .navbar-container {
margin-bottom: 30px;
  }
</style>
<body>

    <canvas id="backgroundCanvas"></canvas>

  <div class="navbar-container">

    <%- include('partials/navbar') %>
  </div>

  <div class="decorations">
    <img src="https://upload.wikimedia.org/wikipedia/commons/b/be/Gamepad.svg" alt="manette" class="decor-icon icon-gamepad" />
    <img src="https://upload.wikimedia.org/wikipedia/commons/8/80/Trophy.svg" alt="trophée" class="decor-icon icon-trophy" />
    <img src="https://upload.wikimedia.org/wikipedia/commons/f/fa/Globe.svg" alt="globe" class="decor-icon icon-globe" />
  </div>

  <!-- Boutons admin -->
  <button id="close-room-btn" style="display:none;">Fermer la room</button>
  <div id="lobby">
    <h2>Lobby</h2>
    <div id="waiting-message">En attente du démarrage du quiz...</div>
    <button id="start-quiz-btn" style="display: none;">Lancer le quiz</button>
  </div>

  <!-- Password prompt -->
  <div id="password-prompt" role="dialog" aria-modal="true" aria-labelledby="password-label">
    <label id="password-label" for="password-input">Entrez le mot de passe :</label>
    <input type="password" id="password-input" placeholder="Mot de passe..." autocomplete="off" />
    <button id="join-room-btn">Rejoindre</button>
  </div>

  <!-- Conteneur principal -->
  <div id="container" style="display:none;">

    <!-- Quiz -->
    <div id="main-quiz" style="display:none;">
      <div id="quiz-info"></div>
      <div id="question-timer"></div>
      <div id="question-container"></div>
      <div id="answers-container"></div>
      <button id="submit-answer" disabled>Valider ma réponse</button>
      <div id="quiz-notification"></div>
    </div>

    <!-- Correction -->
    <div id="correction-panel" style="display:none;">
      <h3>Correction</h3>
      <div id="correction-question"></div>
      <div id="correction-user-answers"></div>
      <button id="prev-correction-btn" disabled>Précédent</button>
      <button id="next-correction-btn">Suivant</button>
      <div id="correction-status"></div>
    </div>

    <!-- Classement -->
    <div id="final-ranking" style="display:none;">
      <h3>Classement final</h3>
      <table id="ranking-table">
        <thead>
          <tr>
            <th>Rang</th>
            <th>Utilisateur</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Right panel -->
<!-- Right panel -->
<!-- Right panel -->
<div id="right-panel">
  <div id="user-list" style="display:none;"></div>

  <div id="chat-box" style="display:none;"></div>

  <form id="chat-form" style="display:none;">
    <input type="text" id="msg" placeholder="Écris un message..." autocomplete="off" />
    <button type="submit">Envoyer</button>
    <div id="typing-indicator" style="font-style: italic; color: #94a3b8; margin-top: 4px; font-size: 0.9rem;"></div>
  </form>
</div>



  <canvas id="backgroundCanvas"></canvas>

  <input type="hidden" id="roomName" value="<%= roomName %>">
  <input type="hidden" id="userRole" value="<%= user.role %>">

  <!-- Scripts modulaires -->
  <script src="/js/room.js"></script>
  <script src="/js/quiz.js"></script>
    <script src="/js/scripthome.js"></script>

  <script>
    // Mettre à jour le tableau de classement final quand le serveur envoie "quizRanking"
    socket.on("quizRanking", ranking => {
      const tbody = document.querySelector("#ranking-table tbody");
      tbody.innerHTML = "";
      ranking.forEach((r, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${idx+1}</td><td>${r.user}</td><td>${r.score}</td>`;
        tbody.appendChild(tr);
      });
      document.getElementById("final-ranking").style.display = "block";
    });
  </script>
</body>
</html>
